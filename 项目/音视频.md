
关键库函数
```
//创建实例
libvlc_new()
//加载媒体
libvlc_media_new_path()/libvlc_media_new_location()（file:///、http://、rtsp://、screen://）
//创建播放器
libvlc_media_player_new_from_media()
//设置播放窗口
libvlc_media_player_set_hwnd()
//开始播放
libvlc_media_player_play()
//获取播放长度
libvlc_media_player_get_length()
//获取播放媒体的宽/高
libvlc_video_get_width()/libvlc_video_get_height()
//获取播放音量
libvlc_audio_get_volume()
//设置音量
libvlc_audio_set_volume()
//获取播放位置
libvlc_media_player_get_position()
//设置播放位置
libvlc_media_player_set_position()
//暂停
libvlc_media_player_pause()
//停止
libvlc_media_player_stop()
//释放播放器
libvlc_media_player_release()
//释放媒体
libvlc_media_release()
//释放实例
libvlc_release()
```
### 设计思路
1、需求
视频播放器
2、核心功能
libvlc 要掌握
mvc架构、.COM/.NET架构
功能
mfc

### 模块设计

MVC架构
- View MFC
- Model libvlc封装起来作为其中一部分
- Controller 

**UI模块CVideoClientDlg**
接口：
- Play、Pause、Stop响应接口
- 定时器OnTimer，来刷新进度条
- 滑动条拖动响应接口
- 地址输入的变量


**libVLC模块EVlc**
接口：
- 初始化
- 设置播放窗口
- 设置播放地址
- 播放/暂停/停止/音量/位置/销毁

**控制层模块VideoClientController**
作用:协调UI和vlc
接口：
- 初始化（播放窗口设置）
- 响应播放、暂停、地址、停止、音量、进度、关闭

**CVideoClientApp模块**
接口：InitInstance


![[vlc项目 client文件.png]]

![[音视频客户端时序图.png]]

![[音视频客户端类图.png]]
VideoClientDlg类定义

![[VideoClientDlg类定义.png]]

VLC封装
![[vlc封装.png]]
![[VLCSize类.png]]

VideoClientController类
![[VideoClientController类.png]]

![[音视频客户端实际效果.png]]


视频服务器


RTSP协议
RTP--数据包 RTCP--命令
先用RTSP信息交互 再用RTP/RTCP媒体传输

SDP格式
多行的key=value
完整的 sdp 包括会话元数据、 网络描述、 流描述、 加密描述、 Qos 和分组描述但是一般会话描述、 网络描述和流描述（也叫媒体描述） 是必须的， 其他的可选v=开始都是会话描述
m=开始都是媒体描述
t=开始时时间描述

会话描述： v 表示版本
o 表示用户、 会话 id、 会话版本、 网络类型、 地址类型、 地址
一个典型的例子是o=- 12345678901 1 IN IP4 127.0.0.1\r\n这个表示
用户名： -
会话 id： 12345678901会话版本： 1
网络类型： IN 就是 internet 的意思地址类型： IP4， 表示 ipv4
地址： 127.0.0.1 表示服务器的地址s 会话名称
i 会话文本信息
`i=<No author> <No copyright>` u 会话信息地址
e 电子邮件地址p 电话信息
c 连接类型和地址c=IN IP4 0.0.0.0 b 带宽限制b=as:150 b=RR:11250 b=RS:3750
z 时区信息k 加密密钥

时间描述：
t 开始和结束时间
r 重复的周期和持续时间

媒体描述：
m=媒体类型、 端口号、 传输协议、 媒体格式一个典型的例子如下
m=video 0 RTP/AVP 96\r\n
注意这里的端口号一般无效， 因为真正的端口号在 SETUP 命令中处理96 代表的是 H.264
a=媒体格式， 有多个内容， 几个典型的例子如下a=rtpmap:96 H264/90000
rtpmap:媒体格式 编码格式/时钟频率a=framerate:25
framerate 表示帧率a=control:track0 a=Width:integer;320 影片宽度
表示该路视频在这个会话中的编号 SETUP 命令会用到i、 c、 b、 k 和会话描述一致的含义（但是内容可能不一样）

协议 （文本协议和二进制协议）
文本协议 总体格式-----具体格式（发送-应答--相应的命令）
二进制协议 也可以这样 但是需要知道每一个比特位代表什么  ---最重要的是**内容成分组成和位宽**
RTP--头部（包的界限和包的内容--防止大量的嗅探包和杂音包）和数据荷载/负载


![[RTP协议头部.png]]
**V 表示版本号**， 2 个 bit--默认是1
**P 表示填充位**， 1 个 bit。 为 0 表示包尾部没有填充附加字节； 为则表示有 （为什么要填充---凑整方便识别和处理）
X 表示扩展位， 1 个 bit。 为 1 表示包头后面还有一个扩展头部--一般不用
CC 是 CSRC 个数， 4bit。 表示后面 CSRC 的个数 0~15 个
M 表示标记位， 1 个 bit。 给配置文档来用的（一般没有）
**PT 表示荷载类型**， 7 个 bit。（0-127）
**序列号（SN）** ， 16 个 bit
**时间戳**， 32 个 bit， 记录数据荷载部分采样时刻（不一定是真的，其他时间也可以）
同步信源（ SSRC） 标识符， 32 个 bit。 标记 RTP 的来源， 一个 RTP 会话中不能有两个 SSRC值。
特约信源（CSRC） 标识符， 最多 15 个， 每个都是 32 个 bit， 一般不用
数据荷载的格式一般依据音视频本身的格式


服务器设计和实现

协议
基于TCP的RTSP服务器
加入协议的处理
基于UDP的RTP服务器
加入数据的处理

#### Socket

WSA初始化
![[socketIniter.png|425]]
socket初始化
![[socket类.png|400]]
socket地址类


