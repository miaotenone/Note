#### 1、socket网络连接

#### 2、单例模式

#### 3、数据包的封装和拆解

#### 4、操作文件
###### 磁盘分区
###### 预编译命令--字节对齐
```
#pragma pack(push) #pragma pack(1) #pragma pack(pop)
```
[[pragma pack命令的作用]]
###### 文件搜索--操作系统文件部分

识别命令--改变目录--_findfirst搜索目录下指定文件 --- 发送（hasnext一步步发送而不是一次性发送）

###### 打开文件

fopen打开的3种方式
1、fopen不安全使用fopen_s 
2、c++编译预处理添加_CRT_SECURE_NO_WARNINGS
3、预编译指令
```
 #pragma warning(disable:4966)
```

开启之后fopen sprintf strcpy strstr这些函数都不会警告 
###### 发送文件

表示进度-


5、鼠标操作
6、屏幕监控---发送图像

7、锁机
弹出消息（顶层显示--dialogue）
模态：有窗口弹出一个独占对话框
非模态：----

限制鼠标---不显示鼠标
线程
8、解锁


关于dealcommand（）函数

显示图像
server 被控端
client 控制端
server截图 发送
client接收显示
数据（线程--缓存）--更新（by timer刷新）--显示（功能函数devicecontext-dc--cdc）
- **CClientDC**：用于客户区的输出，与特定窗口关联，可以让开发者访问目标窗口中的客户区。
- **CPaintDC**：用于响应窗口重绘消息（WM_PAINT）时的绘图输出，它在构造函数中调用BeginPaint()取得设备上下文，在析构函数中调用EndPaint()释放设备上下文。
- **CWindowDC**：可以在非客户区绘制图形，其坐标原点在窗口的左上角。
丢帧-正常--注重实时性
显示--dc--cimage--m_pic

鼠标

抓取--鼠标消息
封装--坐标 事件

按下enter，远控画面会结束，如何解决
1，重载ok
2.wantreturn属性

创建-初始化-连接-业务-清理--循环到连接  回调函数


mvc架构control类实现
界面接口放入、实现单例模式、消息、初始化、启动、挂载位置的变化

sendmessage 确保有返回值

全局或者类的静态变量的初始化先于main函数之前，不存在多线程问题


多线程发送命令导致不同操作在一个packet的缓存里，导致冲突
解决--句柄（mfc的消息机制的原理 获取--分发--处理 基于消息队列）
事件机制---多个请求（队列）----接收（多个之后返回一个handle）---请求方进行下一个命令
单个包--多个tcp包 多个包--多个tcp包（出现多线程问题）


client网络收发机制1------请求方每次收发包都会在sendpacket函数开一个线程，直到收发结束或者返回句柄
client网络收发机制2-----利用mfc类似的消息队列机制进行优化


线程创建了，未执行---需要等待时间 sleep(30)--直接在程序启动的时候启动线程就可以避免在调用时开启线程造成的错误


服务器端加权限和开机自启
开机自启-----注册表或者使用复制到注册文件
管理员权限----检测权限---管理员权限（使用admin登录获取token--用token创建进程）

简化--整合

线程同步---锁、信号量、生产者消费者模型

网络端口映射（[[端口映射]]）


创建iocp-放到线程中----获取状态--有数据进行唤醒
![[Pasted image 20250511095844.png]]

//代码到此，导致本地对象无法调用析构函数，发生内存泄漏
//也即如果end和线程函数放在一起就会直接结束，来不及析构造成内存泄漏
//线程入口函数和功能函数要分开
_endthread();


setsockopt()

IOCP模型架构
socket初始化 -- bind --listen---iocp初始化---iocp绑定socket---线程池初始化并开启---线程池分配任务


udp穿透
[如何实现UDP穿透_udp内网穿透-CSDN博客](https://blog.csdn.net/qq_33960476/article/details/111821928)
[UDP内网穿透和打洞原理与代码实现 - 第七子007 - 博客园](https://www.cnblogs.com/theseventhson/p/14304321.html)


**UDP穿透是一种网络技术，主要用于在NAT（网络地址转换）环境下实现两个位于不同私有网络中的设备之间的直接通信**。以下是UDP穿透的基本原理和实现方法：

#### 基本原理

- **探测公网IP和端口**：内网节点需要找到一个映射到自己内部的公网IP和端口。
- **会话保持**：通过发送周期性的UDP包来保持NAT的会话，确保外部节点可以响应。
- **外部节点的公网IP和端口发现**：内网节点需要知道外部节点的公网IP和端口，这通常通过“信标”服务器来完成。
- **直接连接尝试**：一旦知道外部节点的公网信息，内网节点就可以尝试直接建立连接。

#### 实现方法

- **UPnP（通用即插即用）**：允许设备自动配置NAT设备，开放特定端口映射，实现通信。
- **STUN（会话遍历实用程序NAT）**：帮助位于NAT后的客户端发现其公网IP地址和端口。
- **TURN（通过NAT中继遍历）**：在直接穿透不可行时，使用TURN中继服务器转发数据。
- **ICE（交互式连接建立）**：综合STUN和TURN，尝试多种方式建立P2P连接。

UDP穿透技术在P2P文件共享、VoIP、在线游戏等领域有广泛应用，使设备能够绕过NAT限制，实现直接通信，提高通信效率和降低服务器负载。



![[Pasted image 20250513152927.png]]